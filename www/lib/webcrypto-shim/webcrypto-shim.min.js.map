{"version":3,"sources":["webcrypto-shim.js"],"names":["global","factory","define","amd","module","exports","self","this","s2a","s","btoa","replace","a2s","slice","length","atob","s2b","b","Uint8Array","i","charCodeAt","b2s","ArrayBuffer","String","fromCharCode","apply","alg","a","r","name","toUpperCase","hash","publicExponent","modulusLength","SyntaxError","jwkAlg","HMAC","SHA-1","SHA-256","SHA-384","SHA-512","RSASSA-PKCS1-v1_5","RSAES-PKCS1-v1_5","","RSA-OAEP","AES-KW","128","192","256","AES-GCM","AES-CBC","b2jwk","k","JSON","parse","decodeURIComponent","escape","jwk","kty","ext","extractable","forEach","x","TypeError","b2der","buf","ctx","pos","end","RangeError","tag","len","xlen","rv","subarray","Error","buffer","oid","oid2str","push","toString","der2b","val","byteLength","str2oid","Array","value","splice","CryptoKey","key","use","Object","defineProperties","_key","type","enumerable","undefined","algorithm","usages","isPubKeyUse","u","isPrvKeyUse","Promise","_crypto","crypto","msCrypto","_subtle","subtle","webkitSubtle","_Crypto","Crypto","constructor","_SubtleCrypto","SubtleCrypto","isEdge","Key","navigator","userAgent","indexOf","isIE","isWebkit","KoZIhvcNAQEB","1.2.840.113549.1.1.1","m","_fn","c","ka","kx","ku","args","call","arguments","key_ops","filter","unescape","encodeURIComponent","stringify","jwk2b","importKey","getRandomValues","generateKey","then","all","exportKey","publicKey","privateKey","keys","info","prv","shift","rsaComp","rsaKey","pkcs2jwk","decrypt","op","e","reject","res","rej","onabort","onerror","oncomplete","target","result","search","encrypt","set","unshift","jwk2pkcs","d","tl","tagLength","AesGcmEncryptResult","ciphertext","t","_digest","digest","create"],"mappings":";CAKC,SAAUA,EAAQC,GACO,mBAAXC,QAAyBA,OAAOC,IAEvCD,UAAW,WACP,OAAOD,EAAQD,KAEM,iBAAXI,QAAuBA,OAAOC,QAE5CD,OAAOC,QAAUJ,EAAQD,GAEzBC,EAAQD,GAVhB,CAYkB,oBAATM,KAAuBA,KAAOC,KAAM,SAAUP,GACnD,aAoBA,SAASQ,EAAMC,GACX,OAAOC,KAAKD,GAAGE,QAAQ,OAAQ,IAAIA,QAAQ,MAAO,KAAKA,QAAQ,MAAO,KAG1E,SAASC,EAAMH,GAEX,OADAA,GAAK,MAAOA,EAAIA,EAAEI,MAAO,GAAIJ,EAAEK,OAAS,GACjCC,KAAMN,EAAEE,QAAQ,KAAM,KAAKA,QAAQ,KAAM,MAGpD,SAASK,EAAMP,GAEX,IAAM,IADFQ,EAAI,IAAIC,WAAWT,EAAEK,QACfK,EAAI,EAAGA,EAAIV,EAAEK,OAAQK,IAAMF,EAAEE,GAAKV,EAAEW,WAAWD,GACzD,OAAOF,EAGX,SAASI,EAAMJ,GAEX,OADKA,aAAaK,cAAcL,EAAI,IAAIC,WAAWD,IAC5CM,OAAOC,aAAaC,MAAOF,OAAQN,GAG9C,SAASS,EAAMC,GACX,IAAIC,GAAMC,MAASF,EAAEE,MAAQF,GAAK,IAAIG,cAAcnB,QAAQ,IAAI,MAChE,OAASiB,EAAEC,MACP,IAAK,QACL,IAAK,UACL,IAAK,UACL,IAAK,UACD,MACJ,IAAK,UACL,IAAK,UACL,IAAK,SACIF,EAAEb,SAASc,EAAU,OAAID,EAAEb,QAChC,MACJ,IAAK,OACIa,EAAEI,OAAOH,EAAQ,KAAIF,EAAIC,EAAEI,OAC3BJ,EAAEb,SAASc,EAAU,OAAID,EAAEb,QAChC,MACJ,IAAK,mBACIa,EAAEK,iBAAiBJ,EAAkB,eAAI,IAAIV,WAAWS,EAAEK,iBAC1DL,EAAEM,gBAAgBL,EAAiB,cAAID,EAAEM,eAC9C,MACJ,IAAK,oBACL,IAAK,WACIN,EAAEI,OAAOH,EAAQ,KAAIF,EAAIC,EAAEI,OAC3BJ,EAAEK,iBAAiBJ,EAAkB,eAAI,IAAIV,WAAWS,EAAEK,iBAC1DL,EAAEM,gBAAgBL,EAAiB,cAAID,EAAEM,eAC9C,MACJ,QACI,MAAM,IAAIC,YAAY,sBAE9B,OAAON,EAGX,SAASO,EAASR,GACd,OACIS,MACIC,QAAS,MACTC,UAAW,QACXC,UAAW,QACXC,UAAW,SAEfC,qBACIJ,QAAS,MACTC,UAAW,QACXC,UAAW,QACXC,UAAW,SAEfE,oBACIC,GAAI,UAERC,YACIP,QAAS,WACTC,UAAW,gBAEfO,UACIC,IAAO,SACPC,IAAO,SACPC,IAAO,UAEXC,WACIH,IAAO,UACPC,IAAO,UACPC,IAAO,WAEXE,WACIJ,IAAO,UACPC,IAAO,UACPC,IAAO,YAEbrB,EAAEE,OAASF,EAAEI,UAAaF,MAAQF,EAAEb,QAAU,IAGpD,SAASqC,EAAQC,IACRA,aAAa9B,aAAe8B,aAAalC,cAAakC,EAAIC,KAAKC,MAAOC,mBAAoBC,OAAQnC,EAAI+B,OAC3G,IAAIK,GAAQC,IAAON,EAAEM,IAAKhC,IAAO0B,EAAE1B,IAAKiC,IAAOP,EAAEO,KAAOP,EAAEQ,aAC1D,OAASH,EAAIC,KACT,IAAK,MACDD,EAAIL,EAAIA,EAAEA,EACd,IAAK,OACC,IAAK,IAAK,IAAK,IAAK,IAAK,KAAM,KAAM,KAAM,OAAQS,QAAS,SAAWC,GAAWA,KAAKV,IAAIK,EAAIK,GAAKV,EAAEU,MACxG,MACJ,QACI,MAAM,IAAIC,UAAU,wBAE5B,OAAON,EAyDX,SAASO,EAAQC,EAAKC,GAIlB,GAHKD,aAAe3C,cAAc2C,EAAM,IAAI/C,WAAW+C,IACjDC,IAAMA,GAAQC,IAAK,EAAGC,IAAKH,EAAInD,SAEhCoD,EAAIE,IAAMF,EAAIC,IAAM,GAAKD,EAAIE,IAAMH,EAAInD,OAAS,MAAM,IAAIuD,WAAW,iBAE1E,IAAIC,EAAML,EAAIC,EAAIC,OACdI,EAAMN,EAAIC,EAAIC,OAElB,GAAKI,GAAO,IAAO,CAEf,GADAA,GAAO,IACFL,EAAIE,IAAMF,EAAIC,IAAMI,EAAM,MAAM,IAAIF,WAAW,iBACpD,IAAM,IAAIG,EAAO,EAAGD,KAASC,IAAS,EAAGA,GAAQP,EAAIC,EAAIC,OACzDI,EAAMC,EAGV,GAAKN,EAAIE,IAAMF,EAAIC,IAAMI,EAAM,MAAM,IAAIF,WAAW,iBAEpD,IAAII,EAEJ,OAASH,GACL,KAAK,EACDG,EAAKR,EAAIS,SAAUR,EAAIC,IAAKD,EAAIC,KAAOI,GACvC,MACJ,KAAK,EACD,GAAKN,EAAIC,EAAIC,OAAS,MAAM,IAAIQ,MAAO,0BACvCJ,IACJ,KAAK,EACDE,EAAK,IAAIvD,WAAY+C,EAAIS,SAAUR,EAAIC,IAAKD,EAAIC,KAAOI,IAAQK,OAC/D,MACJ,KAAK,EACDH,EAAK,KACL,MACJ,KAAK,EACD,IAAII,EAAMnE,KAAMW,EAAK4C,EAAIS,SAAUR,EAAIC,IAAKD,EAAIC,KAAOI,KACvD,KAAQM,KAAOC,GAAY,MAAM,IAAIH,MAAO,yBAA2BE,GACvEJ,EAAKK,EAAQD,GACb,MACJ,KAAK,GACDJ,KACA,IAAM,IAAIL,EAAMF,EAAIC,IAAMI,EAAKL,EAAIC,IAAMC,GAAOK,EAAGM,KAAMf,EAAOC,EAAKC,IACrE,MACJ,QACI,MAAM,IAAIS,MAAO,yBAA2BL,EAAIU,SAAS,KAGjE,OAAOP,EAGX,SAASQ,EAAQC,EAAKjB,GACZA,IAAMA,MAEZ,IAAIK,EAAM,EAAGC,EAAM,EACfJ,EAAMF,EAAInD,OAAS,EAIvB,GAFAmD,EAAIc,KAAM,EAAG,GAERG,aAAehE,WAAa,CAC7BoD,EAAM,EAAMC,EAAMW,EAAIpE,OACtB,IAAUK,EAAI,EAAGA,EAAIoD,EAAKpD,IAAM8C,EAAIc,KAAMG,EAAI/D,SAE7C,GAAK+D,aAAe5D,YAAc,CACnCgD,EAAM,EAAMC,EAAMW,EAAIC,WAAYD,EAAM,IAAIhE,WAAWgE,GACvD,IAAU/D,EAAI,EAAGA,EAAIoD,EAAKpD,IAAM8C,EAAIc,KAAMG,EAAI/D,SAE7C,GAAa,OAAR+D,EACNZ,EAAM,EAAMC,EAAM,OAEjB,GAAoB,iBAARW,GAAoBA,KAAOE,EAAU,CAClD,IAAIP,EAAM7D,EAAKD,KAAMqE,EAAQF,KAC7BZ,EAAM,EAAMC,EAAMM,EAAI/D,OACtB,IAAUK,EAAI,EAAGA,EAAIoD,EAAKpD,IAAM8C,EAAIc,KAAMF,EAAI1D,SAE7C,GAAK+D,aAAeG,MAAQ,CAC7B,IAAUlE,EAAI,EAAGA,EAAI+D,EAAIpE,OAAQK,IAAM8D,EAAOC,EAAI/D,GAAI8C,GACtDK,EAAM,GAAMC,EAAMN,EAAInD,OAASqD,MAE9B,CAAA,KAAoB,iBAARe,GAAgC,IAAZA,EAAIZ,KAAgBY,EAAII,iBAAiBhE,aAM1E,MAAM,IAAIqD,MAAO,yBAA2BO,GALXZ,EAAM,EAAMC,GAA7CW,EAAM,IAAIhE,WAAWgE,EAAII,QAA8BH,WACvDlB,EAAIc,KAAK,GAAI,IAAM,IAAI5D,EAAI,EAAGA,EAAIoD,EAAKpD,IAAM8C,EAAIc,KAAMG,EAAI/D,IAC3DoD,IAMJ,GAAKA,GAAO,IAAO,CACf,IAAIC,EAAOD,EAAKA,EAAM,EAEtB,IADAN,EAAIsB,OAAQpB,EAAK,EAAIK,GAAQ,GAAM,IAAOA,GAAQ,GAAM,IAAOA,GAAQ,EAAK,IAAa,IAAPA,GAC1ED,EAAM,KAAOC,GAAQ,KAAMA,IAAS,EAAGD,IAC1CA,EAAM,GAAIN,EAAIsB,OAAQpB,EAAK,EAAII,GACpCA,GAAO,IAKX,OAFAN,EAAIsB,OAAQpB,EAAM,EAAG,EAAGG,EAAKC,GAEtBN,EAGX,SAASuB,EAAYC,EAAK/D,EAAKiC,EAAK+B,GAChCC,OAAOC,iBAAkBrF,MACrBsF,MACIP,MAAOG,GAEXK,MACIR,MAAOG,EAAIK,KACXC,YAAY,GAEhBnC,aACI0B,WAAgBU,IAARrC,EAAqB8B,EAAI7B,YAAcD,EAC/CoC,YAAY,GAEhBE,WACIX,WAAgBU,IAARtE,EAAqB+D,EAAIQ,UAAYvE,EAC7CqE,YAAY,GAEhBG,QACIZ,WAAgBU,IAARN,EAAqBD,EAAIS,OAASR,EAC1CK,YAAY,KAKxB,SAASI,EAAcC,GACnB,MAAa,WAANA,GAAwB,YAANA,GAAyB,YAANA,EAGhD,SAASC,EAAcD,GACnB,MAAa,SAANA,GAAsB,YAANA,GAAyB,cAANA,EAnT9C,GAAwB,mBAAZE,QACR,KAAM,2BAEV,IAAIC,EAAUvG,EAAOwG,QAAUxG,EAAOyG,SACtC,GAAMF,EAAN,CAEA,IAAIG,EAAUH,EAAQI,QAAUJ,EAAQK,aACxC,GAAMF,EAAN,CAEA,IAAIG,EAAc7G,EAAO8G,QAAUP,EAAQQ,aAAepB,OACtDqB,EAAgBhH,EAAOiH,cAAgBP,EAAQK,aAAepB,OAG9DuB,GAFclH,EAAOwF,WAAaxF,EAAOmH,KAAOxB,OAEvC3F,EAAOoH,UAAUC,UAAUC,QAAQ,UAAY,GACxDC,IAAYvH,EAAOyG,WAAaS,EAChCM,GAAYjB,EAAQI,UAAYJ,EAAQK,aAC5C,GAAMW,GAASC,EAAf,CAgKA,IAAI1C,GAAY2C,aAAgB,wBAC5BrC,GAAYsC,uBAAwB,gBAqXxC,IAhPE,cAAe,YAAa,aACzB7D,QAAS,SAAW8D,GACjB,IAAIC,EAAMlB,EAAQiB,GAElBjB,EAAQiB,GAAK,SAAWhG,EAAGV,EAAG4G,GAC1B,IACIC,EAAIC,EAAIC,EADRC,KAAUpH,MAAMqH,KAAKC,WAGzB,OAASR,GACL,IAAK,cACDG,EAAKpG,EAAIC,GAAIoG,EAAK9G,EAAG+G,EAAKH,EAC1B,MACJ,IAAK,YACDC,EAAKpG,EAAImG,GAAIE,EAAKE,EAAK,GAAID,EAAKC,EAAK,GAC1B,QAANtG,KACDV,EAAIkC,EAAMlC,IACFS,MAAMT,EAAES,IAAMS,EAAO2F,IACvB7G,EAAEmH,UAAUnH,EAAEmH,QAAsB,QAAVnH,EAAEyC,IAAoB,MAAOzC,EAAM+G,EAAGK,OAAOhC,GAAe2B,EAAGK,OAAOlC,GAAe6B,EAAGnH,SACxHoH,EAAK,GA3M7B,SAAiB7E,GACb,IAAIK,EAAMN,EAAMC,GAEhB,OADKmE,IAAO9D,EAAiB,YAAIA,EAAIE,WAAYF,EAAIE,KAC9C3C,EAAKsH,SAAUC,mBAAoBlF,KAAKmF,UAAU/E,MAAWmB,OAwMtC6D,CAAMxH,IAEpB,MACJ,IAAK,YACD6G,EAAKG,EAAK,GAAIF,EAAKE,EAAK,GAAID,EAAKC,EAAK,GACtCA,EAAK,GAAKJ,EAAEhC,KAIpB,GAAW,gBAAN8B,GAAmC,SAAZG,EAAGjG,MAAmBiG,EAAG/F,KAEjD,OADA+F,EAAGhH,OAASgH,EAAGhH,SAAYuB,QAAS,IAAKC,UAAW,IAAKC,UAAW,KAAMC,UAAW,MAAOsF,EAAG/F,KAAKF,MAC7F6E,EAAQgC,UAAW,MAAOnC,EAAQoC,gBAAiB,IAAIzH,WAAa4G,EAAGhH,OAAO,GAAI,IAAOgH,EAAIC,EAAIC,GAG5G,GAAKR,GAAkB,gBAANG,GAAmC,sBAAZG,EAAGjG,QAAmCiG,EAAG7F,eAAiB6F,EAAG7F,eAAiB,MAElH,OADAN,EAAID,EAAIC,GAAIA,EAAEE,KAAO,0BAA2BF,EAAEI,KAC3C2E,EAAQkC,YAAajH,GAAG,GAAQ,UAAW,YAC7CkH,KAAM,SAAWzF,GACd,OAAOkD,QAAQwC,KACXpC,EAAQqC,UAAW,MAAO3F,EAAE4F,WAC5BtC,EAAQqC,UAAW,MAAO3F,EAAE6F,gBAGnCJ,KAAM,SAAWK,GAGd,OAFAA,EAAK,GAAGxH,IAAMwH,EAAK,GAAGxH,IAAMS,EAAO2F,GACnCoB,EAAK,GAAGd,QAAUJ,EAAGK,OAAOlC,GAAc+C,EAAK,GAAGd,QAAUJ,EAAGK,OAAOhC,GAC/DC,QAAQwC,KACXpC,EAAQgC,UAAW,MAAOQ,EAAK,GAAIpB,GAAI,EAAMoB,EAAK,GAAGd,SACrD1B,EAAQgC,UAAW,MAAOQ,EAAK,GAAIpB,EAAIC,EAAImB,EAAK,GAAGd,aAG1DS,KAAM,SAAWK,GACd,OACIF,UAAWE,EAAK,GAChBD,WAAYC,EAAK,MAKjC,IAAO1B,GAAcD,GAAmC,WAAzBO,EAAG/F,UAAaF,OAC9B,cAAN8F,GAA2B,QAANhG,GAA2B,SAAZmG,EAAGjG,MAA6B,QAAVZ,EAAEyC,IACnE,OAAOgD,EAAQgC,UAAW,MAAO1H,EAAKJ,EAAIK,EAAEmC,IAAMyE,EAAGI,EAAK,GAAIA,EAAK,IAGvE,GAAKT,GAAkB,cAANG,IAA6B,SAANhG,GAAsB,UAANA,GACpD,OAAO+E,EAAQgC,UAAW,MAlP1C,SAAoBtF,GAChB,IAAI+F,EAAOnF,EAAMZ,GAAIgG,GAAM,EACtBD,EAAKrI,OAAS,IAAIsI,GAAM,EAAMD,EAAKE,SACxC,IAAI5F,GAAQE,KAAO,GACnB,OAASwF,EAAK,GAAG,IACb,IAAK,uBACD,IAAIG,GAAY,IAAK,IAAK,IAAK,IAAK,IAAK,KAAM,KAAM,MACjDC,EAAUvF,EAAOmF,EAAK,IACrBC,GAAMG,EAAOF,QAClB,IAAM,IAAIlI,EAAI,EAAGA,EAAIoI,EAAOzI,OAAQK,IAC1BoI,EAAOpI,GAAG,KAAKoI,EAAOpI,GAAKoI,EAAOpI,GAAGuD,SAAS,IACpDjB,EAAK6F,EAAQnI,IAAOX,EAAKa,EAAKkI,EAAOpI,KAEzCsC,EAAS,IAAI,MACb,MACJ,QACI,MAAM,IAAIM,UAAU,wBAE5B,OAAON,EAgOsC+F,CAASvI,GAAI4G,EAAGI,EAAK,GAAIA,EAAK,IAGnE,GAAKV,GAAc,cAANI,EACT,OAAOjB,EAAQ+C,QAASxB,EAAK,GAAIJ,EAAG5G,GAC/B4H,KAAM,SAAWzF,GACd,OAAOsD,EAAQgC,UAAW/G,EAAGyB,EAAG6E,EAAK,GAAIA,EAAK,GAAIA,EAAK,MAInE,IAAIyB,EACJ,IACIA,EAAK9B,EAAInG,MAAOiF,EAASuB,GAE7B,MAAQ0B,GACJ,OAAOrD,QAAQsD,OAAOD,GA+B1B,OA5BKpC,IACDmC,EAAK,IAAIpD,QAAS,SAAWuD,EAAKC,GAC9BJ,EAAGK,QACHL,EAAGM,QAAa,SAAWL,GAAMG,EAAIH,IACrCD,EAAGO,WAAa,SAAWrI,GAAMiI,EAAIjI,EAAEsI,OAAOC,YAItDT,EAAKA,EAAGb,KAAM,SAAWzF,GAiBrB,MAhBiB,SAAZ0E,EAAGjG,OACEiG,EAAGhH,SAASgH,EAAGhH,OAAS,EAAIsC,EAAE6C,UAAUnF,SAEpB,GAAzBgH,EAAGjG,KAAKuI,OAAO,SACVtC,EAAG7F,gBAAgB6F,EAAG7F,eAAiBmB,EAAE4F,WAAa5F,GAAG6C,UAAUhE,eACnE6F,EAAG9F,iBAAiB8F,EAAG9F,gBAAkBoB,EAAE4F,WAAa5F,GAAG6C,UAAUjE,iBAG3EoB,EADCA,EAAE4F,WAAa5F,EAAE6F,YAEdD,UAAW,IAAIxD,EAAWpC,EAAE4F,UAAWlB,EAAIC,EAAIC,EAAGK,OAAOlC,IACzD8C,WAAY,IAAIzD,EAAWpC,EAAE6F,WAAYnB,EAAIC,EAAIC,EAAGK,OAAOhC,KAI3D,IAAIb,EAAWpC,EAAG0E,EAAIC,EAAIC,SAShD,YAAa,WACVnE,QAAS,SAAW8D,GACjB,IAAIC,EAAMlB,EAAQiB,GAElBjB,EAAQiB,GAAK,SAAWhG,EAAGV,EAAG4G,GAC1B,IAAII,KAAUpH,MAAMqH,KAAKC,WAEzB,OAASR,GACL,IAAK,YACDM,EAAK,GAAKhH,EAAE4E,KACZ,MACJ,IAAK,UACDoC,EAAK,GAAKhH,EAAE4E,KAAMoC,EAAK,GAAKJ,EAAEhC,KAatC,IATO2B,GAAcD,GAA4C,WAAlCtG,EAAEgF,UAAUlE,UAAaF,OACvC,cAAN8F,GAA2B,QAANhG,GAAoC,SAArBV,EAAEgF,UAAUpE,OACvDoG,EAAK,GAAK,QAGTT,GAAkB,cAANG,GAA6B,SAANhG,GAAsB,UAANA,IACpDsG,EAAK,GAAK,OAGTV,GAAc,YAANI,EACT,OAAOjB,EAAQqC,UAAWpH,EAAGV,GACxB4H,KAAM,SAAWzF,GAEd,MADW,QAANzB,IAAcyB,EAAIpC,EAAKsH,SAAUC,mBAAoBlF,KAAKmF,UAAWrF,EAAMC,QACxEsD,EAAQ2D,QAASpC,EAAK,GAAIJ,EAAGzE,KAIjD,IAAIsG,EACJ,IACIA,EAAK9B,EAAInG,MAAOiF,EAASuB,GAE7B,MAAQ0B,GACJ,OAAOrD,QAAQsD,OAAOD,GA+B1B,OA5BKpC,IACDmC,EAAK,IAAIpD,QAAS,SAAWuD,EAAKC,GAC9BJ,EAAGK,QACHL,EAAGM,QAAa,SAAWL,GAAMG,EAAIH,IACrCD,EAAGO,WAAa,SAAWrI,GAAMiI,EAAIjI,EAAEsI,OAAOC,YAI3C,cAANxC,GAA2B,QAANhG,IACtB+H,EAAKA,EAAGb,KAAM,SAAWzF,GACrB,OAAOoE,GAAcD,GAA4C,WAAlCtG,EAAEgF,UAAUlE,UAAaF,OACxB,SAArBZ,EAAEgF,UAAUpE,MACV6B,IAAO,MAAOhC,IAAOS,EAAOlB,EAAEgF,WAAYmC,QAAWnH,EAAEiF,OAAOrF,QAAS8C,KAAO,EAAMP,EAAK5C,EAAKa,EAAI+B,OAE/GA,EAAID,EAAMC,IACF1B,MAAM0B,EAAO,IAAIjB,EAAOlB,EAAEgF,YAC5B7C,EAAEgF,UAAUhF,EAAW,QAAiB,WAAXnC,EAAE6E,KAAsB7E,EAAEiF,OAAOmC,OAAOlC,GAA4B,YAAXlF,EAAE6E,KAAuB7E,EAAEiF,OAAOmC,OAAOhC,GAAepF,EAAEiF,OAAOrF,SACtJuC,OAIVoE,GAAkB,cAANG,GAA6B,SAANhG,GAAsB,UAANA,IACpD+H,EAAKA,EAAGb,KAAM,SAAWzF,GAErB,OADAA,EA/UpB,SAAoBA,GAChB,IAAIqC,EAAK0D,IAAW,GAAI,OAAUC,GAAM,EACxC,OAAShG,EAAEM,KACP,IAAK,MAGD,IAAM,IAFF4F,GAAY,IAAK,IAAK,IAAK,IAAK,IAAK,KAAM,KAAM,MACjDC,KACMpI,EAAI,EAAGA,EAAImI,EAAQxI,QACjBwI,EAAQnI,KAAMiC,EADWjC,IAAM,CAEvC,IAAIF,EAAIsI,EAAOpI,GAAKH,EAAKJ,EAAKwC,EAAGkG,EAAQnI,MAC7B,IAAPF,EAAE,KAAYsI,EAAOpI,GAAK,IAAID,WAAWD,EAAEH,OAAS,GAAIyI,EAAOpI,GAAGmJ,IAAKrJ,EAAG,IAE9EsI,EAAOzI,OAAS,IAAIsI,GAAM,EAAMG,EAAOgB,QAAS,IAAIrJ,YAAY,MACrEiI,EAAK,GAAG,GAAK,uBACb1D,EAAM8D,EACN,MACJ,QACI,MAAM,IAAIxF,UAAU,wBAK5B,OAHAoF,EAAKpE,KAAM,IAAI7D,WAAY+D,EAAMQ,IAAOb,QAClCwE,EACDD,EAAKoB,QAAS,IAAIrJ,YAAY,KADvBiI,EAAK,IAAO7E,IAAO,EAAMgB,MAAS6D,EAAK,IAE5C,IAAIjI,WAAY+D,EAAMkE,IAAQvE,OA0TjB4F,CAAUrH,EAAMC,OAKrBsG,MAIjB,UAAW,UAAW,OAAQ,UAC3B7F,QAAS,SAAW8D,GACjB,IAAIC,EAAMlB,EAAQiB,GAElBjB,EAAQiB,GAAK,SAAWhG,EAAGV,EAAG4G,EAAG4C,GAC7B,GAAKlD,KAAWM,EAAE1C,YAAgBsF,IAAMA,EAAEtF,YACtC,MAAM,IAAIR,MAAM,6BAEpB,IAAIsD,KAAUpH,MAAMqH,KAAKC,WACrBL,EAAKpG,EAAIC,GAEb,GAAK4F,GAAc,YAANI,GAA+B,YAAZG,EAAGjG,KAAqB,CACpD,IAAI6I,EAAK/I,EAAEgJ,WAAa,EACxB1C,EAAK,IAAMJ,EAAEjD,QAAUiD,GAAGhH,MAAO,EAAGgH,EAAE1C,WAAauF,GACnD/I,EAAE2C,KAAOuD,EAAEjD,QAAUiD,GAAGhH,MAAOgH,EAAE1C,WAAauF,GAGlDzC,EAAK,GAAKhH,EAAE4E,KAEZ,IAAI6D,EACJ,IACIA,EAAK9B,EAAInG,MAAOiF,EAASuB,GAE7B,MAAQ0B,GACJ,OAAOrD,QAAQsD,OAAOD,GA0B1B,OAvBKpC,IACDmC,EAAK,IAAIpD,QAAS,SAAWuD,EAAKC,GAC9BJ,EAAGK,QACHL,EAAGM,QAAU,SAAWL,GACpBG,EAAIH,IAGRD,EAAGO,WAAa,SAAWrI,GACnBA,EAAIA,EAAEsI,OAAOC,OAEjB,GAAW,YAANxC,GAAmB/F,aAAagJ,oBAAsB,CACvD,IAAI/C,EAAIjG,EAAEiJ,WAAYC,EAAIlJ,EAAE0C,KAC5B1C,EAAI,IAAIV,WAAY2G,EAAE1C,WAAa2F,EAAE3F,aACnCmF,IAAK,IAAIpJ,WAAW2G,GAAI,GAC1BjG,EAAE0I,IAAK,IAAIpJ,WAAW4J,GAAIjD,EAAE1C,YAC5BvD,EAAIA,EAAEgD,OAGViF,EAAIjI,OAKT8H,KAIdnC,EAAO,CACR,IAAIwD,EAAUrE,EAAQsE,OAEtBtE,EAAgB,OAAI,SAAW/E,EAAGV,GAC9B,IAAMA,EAAEkE,WACJ,MAAM,IAAIR,MAAM,6BAEpB,IAAI+E,EACJ,IACIA,EAAKqB,EAAQ7C,KAAMxB,EAAS/E,EAAGV,GAEnC,MAAQ0I,GACJ,OAAOrD,QAAQsD,OAAOD,GAS1B,OANAD,EAAK,IAAIpD,QAAS,SAAWuD,EAAKC,GAC9BJ,EAAGK,QACHL,EAAGM,QAAa,SAAWL,GAAMG,EAAIH,IACrCD,EAAGO,WAAa,SAAWrI,GAAMiI,EAAIjI,EAAEsI,OAAOC,YAMtDnK,EAAOwG,OAASb,OAAOsF,OAAQ1E,GAC3BoC,iBAAmBrD,MAAO,SAAW3D,GAAM,OAAO4E,EAAQoC,gBAAgBhH,KAC1EgF,QAAmBrB,MAAOoB,KAG9B1G,EAAOwF,UAAYA,EAGlBgC,IACDjB,EAAQI,OAASD,EAEjB1G,EAAO8G,OAASD,EAChB7G,EAAOiH,aAAeD,EACtBhH,EAAOwF,UAAYA","file":"webcrypto-shim.min.js","sourcesContent":["/**\n * @file Web Cryptography API shim\n * @author Artem S Vybornov <vybornov@gmail.com>\n * @license MIT\n */\n(function (global, factory) {\n    if (typeof define === 'function' && define.amd) {\n        // AMD. Register as an anonymous module.\n        define([], function () {\n            return factory(global);\n        });\n    } else if (typeof module === 'object' && module.exports) {\n        // CommonJS-like environments that support module.exports\n        module.exports = factory(global);\n    } else {\n        factory(global);\n    }\n}(typeof self !== 'undefined' ? self : this, function (global) {\n    'use strict';\n\n    if ( typeof Promise !== 'function' )\n        throw \"Promise support required\";\n\n    var _crypto = global.crypto || global.msCrypto;\n    if ( !_crypto ) return;\n\n    var _subtle = _crypto.subtle || _crypto.webkitSubtle;\n    if ( !_subtle ) return;\n\n    var _Crypto     = global.Crypto || _crypto.constructor || Object,\n        _SubtleCrypto = global.SubtleCrypto || _subtle.constructor || Object,\n        _CryptoKey  = global.CryptoKey || global.Key || Object;\n\n    var isEdge = global.navigator.userAgent.indexOf('Edge/') > -1;\n    var isIE    = !!global.msCrypto && !isEdge;\n    var isWebkit = !_crypto.subtle && !!_crypto.webkitSubtle;\n    if ( !isIE && !isWebkit ) return;\n\n    function s2a ( s ) {\n        return btoa(s).replace(/\\=+$/, '').replace(/\\+/g, '-').replace(/\\//g, '_');\n    }\n\n    function a2s ( s ) {\n        s += '===', s = s.slice( 0, -s.length % 4 );\n        return atob( s.replace(/-/g, '+').replace(/_/g, '/') );\n    }\n\n    function s2b ( s ) {\n        var b = new Uint8Array(s.length);\n        for ( var i = 0; i < s.length; i++ ) b[i] = s.charCodeAt(i);\n        return b;\n    }\n\n    function b2s ( b ) {\n        if ( b instanceof ArrayBuffer ) b = new Uint8Array(b);\n        return String.fromCharCode.apply( String, b );\n    }\n\n    function alg ( a ) {\n        var r = { 'name': (a.name || a || '').toUpperCase().replace('V','v') };\n        switch ( r.name ) {\n            case 'SHA-1':\n            case 'SHA-256':\n            case 'SHA-384':\n            case 'SHA-512':\n                break;\n            case 'AES-CBC':\n            case 'AES-GCM':\n            case 'AES-KW':\n                if ( a.length ) r['length'] = a.length;\n                break;\n            case 'HMAC':\n                if ( a.hash ) r['hash'] = alg(a.hash);\n                if ( a.length ) r['length'] = a.length;\n                break;\n            case 'RSAES-PKCS1-v1_5':\n                if ( a.publicExponent ) r['publicExponent'] = new Uint8Array(a.publicExponent);\n                if ( a.modulusLength ) r['modulusLength'] = a.modulusLength;\n                break;\n            case 'RSASSA-PKCS1-v1_5':\n            case 'RSA-OAEP':\n                if ( a.hash ) r['hash'] = alg(a.hash);\n                if ( a.publicExponent ) r['publicExponent'] = new Uint8Array(a.publicExponent);\n                if ( a.modulusLength ) r['modulusLength'] = a.modulusLength;\n                break;\n            default:\n                throw new SyntaxError(\"Bad algorithm name\");\n        }\n        return r;\n    };\n\n    function jwkAlg ( a ) {\n        return {\n            'HMAC': {\n                'SHA-1': 'HS1',\n                'SHA-256': 'HS256',\n                'SHA-384': 'HS384',\n                'SHA-512': 'HS512',\n            },\n            'RSASSA-PKCS1-v1_5': {\n                'SHA-1': 'RS1',\n                'SHA-256': 'RS256',\n                'SHA-384': 'RS384',\n                'SHA-512': 'RS512',\n            },\n            'RSAES-PKCS1-v1_5': {\n                '': 'RSA1_5',\n            },\n            'RSA-OAEP': {\n                'SHA-1': 'RSA-OAEP',\n                'SHA-256': 'RSA-OAEP-256',\n            },\n            'AES-KW': {\n                '128': 'A128KW',\n                '192': 'A192KW',\n                '256': 'A256KW',\n            },\n            'AES-GCM': {\n                '128': 'A128GCM',\n                '192': 'A192GCM',\n                '256': 'A256GCM',\n            },\n            'AES-CBC': {\n                '128': 'A128CBC',\n                '192': 'A192CBC',\n                '256': 'A256CBC',\n            },\n        }[a.name][ ( a.hash || {} ).name || a.length || '' ];\n    }\n\n    function b2jwk ( k ) {\n        if ( k instanceof ArrayBuffer || k instanceof Uint8Array ) k = JSON.parse( decodeURIComponent( escape( b2s(k) ) ) );\n        var jwk = { 'kty': k.kty, 'alg': k.alg, 'ext': k.ext || k.extractable };\n        switch ( jwk.kty ) {\n            case 'oct':\n                jwk.k = k.k;\n            case 'RSA':\n                [ 'n', 'e', 'd', 'p', 'q', 'dp', 'dq', 'qi', 'oth' ].forEach( function ( x ) { if ( x in k ) jwk[x] = k[x] } );\n                break;\n            default:\n                throw new TypeError(\"Unsupported key type\");\n        }\n        return jwk;\n    }\n\n    function jwk2b ( k ) {\n        var jwk = b2jwk(k);\n        if ( isIE ) jwk['extractable'] = jwk.ext, delete jwk.ext;\n        return s2b( unescape( encodeURIComponent( JSON.stringify(jwk) ) ) ).buffer;\n    }\n\n    function pkcs2jwk ( k ) {\n        var info = b2der(k), prv = false;\n        if ( info.length > 2 ) prv = true, info.shift(); // remove version from PKCS#8 PrivateKeyInfo structure\n        var jwk = { 'ext': true };\n        switch ( info[0][0] ) {\n            case '1.2.840.113549.1.1.1':\n                var rsaComp = [ 'n', 'e', 'd', 'p', 'q', 'dp', 'dq', 'qi' ],\n                    rsaKey  = b2der( info[1] );\n                if ( prv ) rsaKey.shift(); // remove version from PKCS#1 RSAPrivateKey structure\n                for ( var i = 0; i < rsaKey.length; i++ ) {\n                    if ( !rsaKey[i][0] ) rsaKey[i] = rsaKey[i].subarray(1);\n                    jwk[ rsaComp[i] ] = s2a( b2s( rsaKey[i] ) );\n                }\n                jwk['kty'] = 'RSA';\n                break;\n            default:\n                throw new TypeError(\"Unsupported key type\");\n        }\n        return jwk;\n    }\n\n    function jwk2pkcs ( k ) {\n        var key, info = [ [ '', null ] ], prv = false;\n        switch ( k.kty ) {\n            case 'RSA':\n                var rsaComp = [ 'n', 'e', 'd', 'p', 'q', 'dp', 'dq', 'qi' ],\n                    rsaKey = [];\n                for ( var i = 0; i < rsaComp.length; i++ ) {\n                    if ( !( rsaComp[i] in k ) ) break;\n                    var b = rsaKey[i] = s2b( a2s( k[ rsaComp[i] ] ) );\n                    if ( b[0] & 0x80 ) rsaKey[i] = new Uint8Array(b.length + 1), rsaKey[i].set( b, 1 );\n                }\n                if ( rsaKey.length > 2 ) prv = true, rsaKey.unshift( new Uint8Array([0]) ); // add version to PKCS#1 RSAPrivateKey structure\n                info[0][0] = '1.2.840.113549.1.1.1';\n                key = rsaKey;\n                break;\n            default:\n                throw new TypeError(\"Unsupported key type\");\n        }\n        info.push( new Uint8Array( der2b(key) ).buffer );\n        if ( !prv ) info[1] = { 'tag': 0x03, 'value': info[1] };\n        else info.unshift( new Uint8Array([0]) ); // add version to PKCS#8 PrivateKeyInfo structure\n        return new Uint8Array( der2b(info) ).buffer;\n    }\n\n    var oid2str = { 'KoZIhvcNAQEB': '1.2.840.113549.1.1.1' },\n        str2oid = { '1.2.840.113549.1.1.1': 'KoZIhvcNAQEB' };\n\n    function b2der ( buf, ctx ) {\n        if ( buf instanceof ArrayBuffer ) buf = new Uint8Array(buf);\n        if ( !ctx ) ctx = { pos: 0, end: buf.length };\n\n        if ( ctx.end - ctx.pos < 2 || ctx.end > buf.length ) throw new RangeError(\"Malformed DER\");\n\n        var tag = buf[ctx.pos++],\n            len = buf[ctx.pos++];\n\n        if ( len >= 0x80 ) {\n            len &= 0x7f;\n            if ( ctx.end - ctx.pos < len ) throw new RangeError(\"Malformed DER\");\n            for ( var xlen = 0; len--; ) xlen <<= 8, xlen |= buf[ctx.pos++];\n            len = xlen;\n        }\n\n        if ( ctx.end - ctx.pos < len ) throw new RangeError(\"Malformed DER\");\n\n        var rv;\n\n        switch ( tag ) {\n            case 0x02: // Universal Primitive INTEGER\n                rv = buf.subarray( ctx.pos, ctx.pos += len );\n                break;\n            case 0x03: // Universal Primitive BIT STRING\n                if ( buf[ctx.pos++] ) throw new Error( \"Unsupported bit string\" );\n                len--;\n            case 0x04: // Universal Primitive OCTET STRING\n                rv = new Uint8Array( buf.subarray( ctx.pos, ctx.pos += len ) ).buffer;\n                break;\n            case 0x05: // Universal Primitive NULL\n                rv = null;\n                break;\n            case 0x06: // Universal Primitive OBJECT IDENTIFIER\n                var oid = btoa( b2s( buf.subarray( ctx.pos, ctx.pos += len ) ) );\n                if ( !( oid in oid2str ) ) throw new Error( \"Unsupported OBJECT ID \" + oid );\n                rv = oid2str[oid];\n                break;\n            case 0x30: // Universal Constructed SEQUENCE\n                rv = [];\n                for ( var end = ctx.pos + len; ctx.pos < end; ) rv.push( b2der( buf, ctx ) );\n                break;\n            default:\n                throw new Error( \"Unsupported DER tag 0x\" + tag.toString(16) );\n        }\n\n        return rv;\n    }\n\n    function der2b ( val, buf ) {\n        if ( !buf ) buf = [];\n\n        var tag = 0, len = 0,\n            pos = buf.length + 2;\n\n        buf.push( 0, 0 ); // placeholder\n\n        if ( val instanceof Uint8Array ) {  // Universal Primitive INTEGER\n            tag = 0x02, len = val.length;\n            for ( var i = 0; i < len; i++ ) buf.push( val[i] );\n        }\n        else if ( val instanceof ArrayBuffer ) { // Universal Primitive OCTET STRING\n            tag = 0x04, len = val.byteLength, val = new Uint8Array(val);\n            for ( var i = 0; i < len; i++ ) buf.push( val[i] );\n        }\n        else if ( val === null ) { // Universal Primitive NULL\n            tag = 0x05, len = 0;\n        }\n        else if ( typeof val === 'string' && val in str2oid ) { // Universal Primitive OBJECT IDENTIFIER\n            var oid = s2b( atob( str2oid[val] ) );\n            tag = 0x06, len = oid.length;\n            for ( var i = 0; i < len; i++ ) buf.push( oid[i] );\n        }\n        else if ( val instanceof Array ) { // Universal Constructed SEQUENCE\n            for ( var i = 0; i < val.length; i++ ) der2b( val[i], buf );\n            tag = 0x30, len = buf.length - pos;\n        }\n        else if ( typeof val === 'object' && val.tag === 0x03 && val.value instanceof ArrayBuffer ) { // Tag hint\n            val = new Uint8Array(val.value), tag = 0x03, len = val.byteLength;\n            buf.push(0); for ( var i = 0; i < len; i++ ) buf.push( val[i] );\n            len++;\n        }\n        else {\n            throw new Error( \"Unsupported DER value \" + val );\n        }\n\n        if ( len >= 0x80 ) {\n            var xlen = len, len = 4;\n            buf.splice( pos, 0, (xlen >> 24) & 0xff, (xlen >> 16) & 0xff, (xlen >> 8) & 0xff, xlen & 0xff );\n            while ( len > 1 && !(xlen >> 24) ) xlen <<= 8, len--;\n            if ( len < 4 ) buf.splice( pos, 4 - len );\n            len |= 0x80;\n        }\n\n        buf.splice( pos - 2, 2, tag, len );\n\n        return buf;\n    }\n\n    function CryptoKey ( key, alg, ext, use ) {\n        Object.defineProperties( this, {\n            _key: {\n                value: key\n            },\n            type: {\n                value: key.type,\n                enumerable: true,\n            },\n            extractable: {\n                value: (ext === undefined) ? key.extractable : ext,\n                enumerable: true,\n            },\n            algorithm: {\n                value: (alg === undefined) ? key.algorithm : alg,\n                enumerable: true,\n            },\n            usages: {\n                value: (use === undefined) ? key.usages : use,\n                enumerable: true,\n            },\n        });\n    }\n\n    function isPubKeyUse ( u ) {\n        return u === 'verify' || u === 'encrypt' || u === 'wrapKey';\n    }\n\n    function isPrvKeyUse ( u ) {\n        return u === 'sign' || u === 'decrypt' || u === 'unwrapKey';\n    }\n\n    [ 'generateKey', 'importKey', 'unwrapKey' ]\n        .forEach( function ( m ) {\n            var _fn = _subtle[m];\n\n            _subtle[m] = function ( a, b, c ) {\n                var args = [].slice.call(arguments),\n                    ka, kx, ku;\n\n                switch ( m ) {\n                    case 'generateKey':\n                        ka = alg(a), kx = b, ku = c;\n                        break;\n                    case 'importKey':\n                        ka = alg(c), kx = args[3], ku = args[4];\n                        if ( a === 'jwk' ) {\n                            b = b2jwk(b);\n                            if ( !b.alg ) b.alg = jwkAlg(ka);\n                            if ( !b.key_ops ) b.key_ops = ( b.kty !== 'oct' ) ? ( 'd' in b ) ? ku.filter(isPrvKeyUse) : ku.filter(isPubKeyUse) : ku.slice();\n                            args[1] = jwk2b(b);\n                        }\n                        break;\n                    case 'unwrapKey':\n                        ka = args[4], kx = args[5], ku = args[6];\n                        args[2] = c._key;\n                        break;\n                }\n\n                if ( m === 'generateKey' && ka.name === 'HMAC' && ka.hash ) {\n                    ka.length = ka.length || { 'SHA-1': 512, 'SHA-256': 512, 'SHA-384': 1024, 'SHA-512': 1024 }[ka.hash.name];\n                    return _subtle.importKey( 'raw', _crypto.getRandomValues( new Uint8Array( (ka.length+7)>>3 ) ), ka, kx, ku );\n                }\n\n                if ( isWebkit && m === 'generateKey' && ka.name === 'RSASSA-PKCS1-v1_5' && ( !ka.modulusLength || ka.modulusLength >= 2048 ) ) {\n                    a = alg(a), a.name = 'RSAES-PKCS1-v1_5', delete a.hash;\n                    return _subtle.generateKey( a, true, [ 'encrypt', 'decrypt' ] )\n                        .then( function ( k ) {\n                            return Promise.all([\n                                _subtle.exportKey( 'jwk', k.publicKey ),\n                                _subtle.exportKey( 'jwk', k.privateKey ),\n                            ]);\n                        })\n                        .then( function ( keys ) {\n                            keys[0].alg = keys[1].alg = jwkAlg(ka);\n                            keys[0].key_ops = ku.filter(isPubKeyUse), keys[1].key_ops = ku.filter(isPrvKeyUse);\n                            return Promise.all([\n                                _subtle.importKey( 'jwk', keys[0], ka, true, keys[0].key_ops ),\n                                _subtle.importKey( 'jwk', keys[1], ka, kx, keys[1].key_ops ),\n                            ]);\n                        })\n                        .then( function ( keys ) {\n                            return {\n                                publicKey: keys[0],\n                                privateKey: keys[1],\n                            };\n                        });\n                }\n\n                if ( ( isWebkit || ( isIE && ( ka.hash || {} ).name === 'SHA-1' ) )\n                        && m === 'importKey' && a === 'jwk' && ka.name === 'HMAC' && b.kty === 'oct' ) {\n                    return _subtle.importKey( 'raw', s2b( a2s(b.k) ), c, args[3], args[4] );\n                }\n\n                if ( isWebkit && m === 'importKey' && ( a === 'spki' || a === 'pkcs8' ) ) {\n                    return _subtle.importKey( 'jwk', pkcs2jwk(b), c, args[3], args[4] );\n                }\n\n                if ( isIE && m === 'unwrapKey' ) {\n                    return _subtle.decrypt( args[3], c, b )\n                        .then( function ( k ) {\n                            return _subtle.importKey( a, k, args[4], args[5], args[6] );\n                        });\n                }\n\n                var op;\n                try {\n                    op = _fn.apply( _subtle, args );\n                }\n                catch ( e ) {\n                    return Promise.reject(e);\n                }\n\n                if ( isIE ) {\n                    op = new Promise( function ( res, rej ) {\n                        op.onabort =\n                        op.onerror =    function ( e ) { rej(e)               };\n                        op.oncomplete = function ( r ) { res(r.target.result) };\n                    });\n                }\n\n                op = op.then( function ( k ) {\n                    if ( ka.name === 'HMAC' ) {\n                        if ( !ka.length ) ka.length = 8 * k.algorithm.length;\n                    }\n                    if ( ka.name.search('RSA') == 0 ) {\n                        if ( !ka.modulusLength ) ka.modulusLength = (k.publicKey || k).algorithm.modulusLength;\n                        if ( !ka.publicExponent ) ka.publicExponent = (k.publicKey || k).algorithm.publicExponent;\n                    }\n                    if ( k.publicKey && k.privateKey ) {\n                        k = {\n                            publicKey: new CryptoKey( k.publicKey, ka, kx, ku.filter(isPubKeyUse) ),\n                            privateKey: new CryptoKey( k.privateKey, ka, kx, ku.filter(isPrvKeyUse) ),\n                        };\n                    }\n                    else {\n                        k = new CryptoKey( k, ka, kx, ku );\n                    }\n                    return k;\n                });\n\n                return op;\n            }\n        });\n\n    [ 'exportKey', 'wrapKey' ]\n        .forEach( function ( m ) {\n            var _fn = _subtle[m];\n\n            _subtle[m] = function ( a, b, c ) {\n                var args = [].slice.call(arguments);\n\n                switch ( m ) {\n                    case 'exportKey':\n                        args[1] = b._key;\n                        break;\n                    case 'wrapKey':\n                        args[1] = b._key, args[2] = c._key;\n                        break;\n                }\n\n                if ( ( isWebkit || ( isIE && ( b.algorithm.hash || {} ).name === 'SHA-1' ) )\n                        && m === 'exportKey' && a === 'jwk' && b.algorithm.name === 'HMAC' ) {\n                    args[0] = 'raw';\n                }\n\n                if ( isWebkit && m === 'exportKey' && ( a === 'spki' || a === 'pkcs8' ) ) {\n                    args[0] = 'jwk';\n                }\n\n                if ( isIE && m === 'wrapKey' ) {\n                    return _subtle.exportKey( a, b )\n                        .then( function ( k ) {\n                            if ( a === 'jwk' ) k = s2b( unescape( encodeURIComponent( JSON.stringify( b2jwk(k) ) ) ) );\n                            return  _subtle.encrypt( args[3], c, k );\n                        });\n                }\n\n                var op;\n                try {\n                    op = _fn.apply( _subtle, args );\n                }\n                catch ( e ) {\n                    return Promise.reject(e);\n                }\n\n                if ( isIE ) {\n                    op = new Promise( function ( res, rej ) {\n                        op.onabort =\n                        op.onerror =    function ( e ) { rej(e)               };\n                        op.oncomplete = function ( r ) { res(r.target.result) };\n                    });\n                }\n\n                if ( m === 'exportKey' && a === 'jwk' ) {\n                    op = op.then( function ( k ) {\n                        if ( ( isWebkit || ( isIE && ( b.algorithm.hash || {} ).name === 'SHA-1' ) )\n                                && b.algorithm.name === 'HMAC') {\n                            return { 'kty': 'oct', 'alg': jwkAlg(b.algorithm), 'key_ops': b.usages.slice(), 'ext': true, 'k': s2a( b2s(k) ) };\n                        }\n                        k = b2jwk(k);\n                        if ( !k.alg ) k['alg'] = jwkAlg(b.algorithm);\n                        if ( !k.key_ops ) k['key_ops'] = ( b.type === 'public' ) ? b.usages.filter(isPubKeyUse) : ( b.type === 'private' ) ? b.usages.filter(isPrvKeyUse) : b.usages.slice();\n                        return k;\n                    });\n                }\n\n                if ( isWebkit && m === 'exportKey' && ( a === 'spki' || a === 'pkcs8' ) ) {\n                    op = op.then( function ( k ) {\n                        k = jwk2pkcs( b2jwk(k) );\n                        return k;\n                    });\n                }\n\n                return op;\n            }\n        });\n\n    [ 'encrypt', 'decrypt', 'sign', 'verify' ]\n        .forEach( function ( m ) {\n            var _fn = _subtle[m];\n\n            _subtle[m] = function ( a, b, c, d ) {\n                if ( isIE && ( !c.byteLength || ( d && !d.byteLength ) ) )\n                    throw new Error(\"Empy input is not allowed\");\n\n                var args = [].slice.call(arguments),\n                    ka = alg(a);\n\n                if ( isIE && m === 'decrypt' && ka.name === 'AES-GCM' ) {\n                    var tl = a.tagLength >> 3;\n                    args[2] = (c.buffer || c).slice( 0, c.byteLength - tl ),\n                    a.tag = (c.buffer || c).slice( c.byteLength - tl );\n                }\n\n                args[1] = b._key;\n\n                var op;\n                try {\n                    op = _fn.apply( _subtle, args );\n                }\n                catch ( e ) {\n                    return Promise.reject(e);\n                }\n\n                if ( isIE ) {\n                    op = new Promise( function ( res, rej ) {\n                        op.onabort =\n                        op.onerror = function ( e ) {\n                            rej(e);\n                        };\n\n                        op.oncomplete = function ( r ) {\n                            var r = r.target.result;\n\n                            if ( m === 'encrypt' && r instanceof AesGcmEncryptResult ) {\n                                var c = r.ciphertext, t = r.tag;\n                                r = new Uint8Array( c.byteLength + t.byteLength );\n                                r.set( new Uint8Array(c), 0 );\n                                r.set( new Uint8Array(t), c.byteLength );\n                                r = r.buffer;\n                            }\n\n                            res(r);\n                        };\n                    });\n                }\n\n                return op;\n            }\n        });\n\n    if ( isIE ) {\n        var _digest = _subtle.digest;\n\n        _subtle['digest'] = function ( a, b ) {\n            if ( !b.byteLength )\n                throw new Error(\"Empy input is not allowed\");\n\n            var op;\n            try {\n                op = _digest.call( _subtle, a, b );\n            }\n            catch ( e ) {\n                return Promise.reject(e);\n            }\n\n            op = new Promise( function ( res, rej ) {\n                op.onabort =\n                op.onerror =    function ( e ) { rej(e)               };\n                op.oncomplete = function ( r ) { res(r.target.result) };\n            });\n\n            return op;\n        };\n\n        global.crypto = Object.create( _crypto, {\n            getRandomValues: { value: function ( a ) { return _crypto.getRandomValues(a) } },\n            subtle:          { value: _subtle },\n        });\n\n        global.CryptoKey = CryptoKey;\n    }\n\n    if ( isWebkit ) {\n        _crypto.subtle = _subtle;\n\n        global.Crypto = _Crypto;\n        global.SubtleCrypto = _SubtleCrypto;\n        global.CryptoKey = CryptoKey;\n    }\n}));\n"]}