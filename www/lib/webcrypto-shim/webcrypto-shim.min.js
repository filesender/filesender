/*! WebCrypto API shim v0.1.4, (c) 2015 Artem S Vybornov <vybornov@gmail.com>, opensource.org/licenses/MIT */
!function(e,r){"function"==typeof define&&define.amd?define([],function(){return r(e)}):"object"==typeof module&&module.exports?module.exports=r(e):r(e)}("undefined"!=typeof self?self:this,function(e){"use strict";function r(e){return btoa(e).replace(/\=+$/,"").replace(/\+/g,"-").replace(/\//g,"_")}function t(e){return e+="===",e=e.slice(0,-e.length%4),atob(e.replace(/-/g,"+").replace(/_/g,"/"))}function n(e){for(var r=new Uint8Array(e.length),t=0;t<e.length;t++)r[t]=e.charCodeAt(t);return r}function a(e){return e instanceof ArrayBuffer&&(e=new Uint8Array(e)),String.fromCharCode.apply(String,e)}function o(e){var r={name:(e.name||e||"").toUpperCase().replace("V","v")};switch(r.name){case"SHA-1":case"SHA-256":case"SHA-384":case"SHA-512":break;case"AES-CBC":case"AES-GCM":case"AES-KW":e.length&&(r.length=e.length);break;case"HMAC":e.hash&&(r.hash=o(e.hash)),e.length&&(r.length=e.length);break;case"RSAES-PKCS1-v1_5":e.publicExponent&&(r.publicExponent=new Uint8Array(e.publicExponent)),e.modulusLength&&(r.modulusLength=e.modulusLength);break;case"RSASSA-PKCS1-v1_5":case"RSA-OAEP":e.hash&&(r.hash=o(e.hash)),e.publicExponent&&(r.publicExponent=new Uint8Array(e.publicExponent)),e.modulusLength&&(r.modulusLength=e.modulusLength);break;default:throw new SyntaxError("Bad algorithm name")}return r}function i(e){return{HMAC:{"SHA-1":"HS1","SHA-256":"HS256","SHA-384":"HS384","SHA-512":"HS512"},"RSASSA-PKCS1-v1_5":{"SHA-1":"RS1","SHA-256":"RS256","SHA-384":"RS384","SHA-512":"RS512"},"RSAES-PKCS1-v1_5":{"":"RSA1_5"},"RSA-OAEP":{"SHA-1":"RSA-OAEP","SHA-256":"RSA-OAEP-256"},"AES-KW":{128:"A128KW",192:"A192KW",256:"A256KW"},"AES-GCM":{128:"A128GCM",192:"A192GCM",256:"A256GCM"},"AES-CBC":{128:"A128CBC",192:"A192CBC",256:"A256CBC"}}[e.name][(e.hash||{}).name||e.length||""]}function u(e){(e instanceof ArrayBuffer||e instanceof Uint8Array)&&(e=JSON.parse(decodeURIComponent(escape(a(e)))));var r={kty:e.kty,alg:e.alg,ext:e.ext||e.extractable};switch(r.kty){case"oct":r.k=e.k;case"RSA":["n","e","d","p","q","dp","dq","qi","oth"].forEach(function(t){t in e&&(r[t]=e[t])});break;default:throw new TypeError("Unsupported key type")}return r}function s(e,r){if(e instanceof ArrayBuffer&&(e=new Uint8Array(e)),r||(r={pos:0,end:e.length}),r.end-r.pos<2||r.end>e.length)throw new RangeError("Malformed DER");var t=e[r.pos++],n=e[r.pos++];if(n>=128){if(n&=127,r.end-r.pos<n)throw new RangeError("Malformed DER");for(var o=0;n--;)o<<=8,o|=e[r.pos++];n=o}if(r.end-r.pos<n)throw new RangeError("Malformed DER");var i;switch(t){case 2:i=e.subarray(r.pos,r.pos+=n);break;case 3:if(e[r.pos++])throw new Error("Unsupported bit string");n--;case 4:i=new Uint8Array(e.subarray(r.pos,r.pos+=n)).buffer;break;case 5:i=null;break;case 6:var u=btoa(a(e.subarray(r.pos,r.pos+=n)));if(!(u in d))throw new Error("Unsupported OBJECT ID "+u);i=d[u];break;case 48:i=[];for(var c=r.pos+n;r.pos<c;)i.push(s(e,r));break;default:throw new Error("Unsupported DER tag 0x"+t.toString(16))}return i}function c(e,r){r||(r=[]);var t=0,a=0,o=r.length+2;if(r.push(0,0),e instanceof Uint8Array){t=2,a=e.length;for(u=0;u<a;u++)r.push(e[u])}else if(e instanceof ArrayBuffer){t=4,a=e.byteLength,e=new Uint8Array(e);for(u=0;u<a;u++)r.push(e[u])}else if(null===e)t=5,a=0;else if("string"==typeof e&&e in S){var i=n(atob(S[e]));t=6,a=i.length;for(u=0;u<a;u++)r.push(i[u])}else if(e instanceof Array){for(u=0;u<e.length;u++)c(e[u],r);t=48,a=r.length-o}else{if(!("object"==typeof e&&3===e.tag&&e.value instanceof ArrayBuffer))throw new Error("Unsupported DER value "+e);t=3,a=(e=new Uint8Array(e.value)).byteLength,r.push(0);for(var u=0;u<a;u++)r.push(e[u]);a++}if(a>=128){var s=a,a=4;for(r.splice(o,0,s>>24&255,s>>16&255,s>>8&255,255&s);a>1&&!(s>>24);)s<<=8,a--;a<4&&r.splice(o,4-a),a|=128}return r.splice(o-2,2,t,a),r}function p(e,r,t,n){Object.defineProperties(this,{_key:{value:e},type:{value:e.type,enumerable:!0},extractable:{value:void 0===t?e.extractable:t,enumerable:!0},algorithm:{value:void 0===r?e.algorithm:r,enumerable:!0},usages:{value:void 0===n?e.usages:n,enumerable:!0}})}function l(e){return"verify"===e||"encrypt"===e||"wrapKey"===e}function y(e){return"sign"===e||"decrypt"===e||"unwrapKey"===e}if("function"!=typeof Promise)throw"Promise support required";var f=e.crypto||e.msCrypto;if(f){var h=f.subtle||f.webkitSubtle;if(h){var g=e.Crypto||f.constructor||Object,A=e.SubtleCrypto||h.constructor||Object,m=(e.CryptoKey||e.Key||Object,e.navigator.userAgent.indexOf("Edge/")>-1),b=!!e.msCrypto&&!m,w=!f.subtle&&!!f.webkitSubtle;if(b||w){var d={KoZIhvcNAQEB:"1.2.840.113549.1.1.1"},S={"1.2.840.113549.1.1.1":"KoZIhvcNAQEB"};if(["generateKey","importKey","unwrapKey"].forEach(function(e){var c=h[e];h[e]=function(g,A,m){var d,S,v,k=[].slice.call(arguments);switch(e){case"generateKey":d=o(g),S=A,v=m;break;case"importKey":d=o(m),S=k[3],v=k[4],"jwk"===g&&((A=u(A)).alg||(A.alg=i(d)),A.key_ops||(A.key_ops="oct"!==A.kty?"d"in A?v.filter(y):v.filter(l):v.slice()),k[1]=function(e){var r=u(e);return b&&(r.extractable=r.ext,delete r.ext),n(unescape(encodeURIComponent(JSON.stringify(r)))).buffer}(A));break;case"unwrapKey":d=k[4],S=k[5],v=k[6],k[2]=m._key}if("generateKey"===e&&"HMAC"===d.name&&d.hash)return d.length=d.length||{"SHA-1":512,"SHA-256":512,"SHA-384":1024,"SHA-512":1024}[d.hash.name],h.importKey("raw",f.getRandomValues(new Uint8Array(d.length+7>>3)),d,S,v);if(w&&"generateKey"===e&&"RSASSA-PKCS1-v1_5"===d.name&&(!d.modulusLength||d.modulusLength>=2048))return g=o(g),g.name="RSAES-PKCS1-v1_5",delete g.hash,h.generateKey(g,!0,["encrypt","decrypt"]).then(function(e){return Promise.all([h.exportKey("jwk",e.publicKey),h.exportKey("jwk",e.privateKey)])}).then(function(e){return e[0].alg=e[1].alg=i(d),e[0].key_ops=v.filter(l),e[1].key_ops=v.filter(y),Promise.all([h.importKey("jwk",e[0],d,!0,e[0].key_ops),h.importKey("jwk",e[1],d,S,e[1].key_ops)])}).then(function(e){return{publicKey:e[0],privateKey:e[1]}});if((w||b&&"SHA-1"===(d.hash||{}).name)&&"importKey"===e&&"jwk"===g&&"HMAC"===d.name&&"oct"===A.kty)return h.importKey("raw",n(t(A.k)),m,k[3],k[4]);if(w&&"importKey"===e&&("spki"===g||"pkcs8"===g))return h.importKey("jwk",function(e){var t=s(e),n=!1;t.length>2&&(n=!0,t.shift());var o={ext:!0};switch(t[0][0]){case"1.2.840.113549.1.1.1":var i=["n","e","d","p","q","dp","dq","qi"],u=s(t[1]);n&&u.shift();for(var c=0;c<u.length;c++)u[c][0]||(u[c]=u[c].subarray(1)),o[i[c]]=r(a(u[c]));o.kty="RSA";break;default:throw new TypeError("Unsupported key type")}return o}(A),m,k[3],k[4]);if(b&&"unwrapKey"===e)return h.decrypt(k[3],m,A).then(function(e){return h.importKey(g,e,k[4],k[5],k[6])});var K;try{K=c.apply(h,k)}catch(e){return Promise.reject(e)}return b&&(K=new Promise(function(e,r){K.onabort=K.onerror=function(e){r(e)},K.oncomplete=function(r){e(r.target.result)}})),K=K.then(function(e){return"HMAC"===d.name&&(d.length||(d.length=8*e.algorithm.length)),0==d.name.search("RSA")&&(d.modulusLength||(d.modulusLength=(e.publicKey||e).algorithm.modulusLength),d.publicExponent||(d.publicExponent=(e.publicKey||e).algorithm.publicExponent)),e=e.publicKey&&e.privateKey?{publicKey:new p(e.publicKey,d,S,v.filter(l)),privateKey:new p(e.privateKey,d,S,v.filter(y))}:new p(e,d,S,v)})}}),["exportKey","wrapKey"].forEach(function(e){var o=h[e];h[e]=function(s,p,f){var g=[].slice.call(arguments);switch(e){case"exportKey":g[1]=p._key;break;case"wrapKey":g[1]=p._key,g[2]=f._key}if((w||b&&"SHA-1"===(p.algorithm.hash||{}).name)&&"exportKey"===e&&"jwk"===s&&"HMAC"===p.algorithm.name&&(g[0]="raw"),!w||"exportKey"!==e||"spki"!==s&&"pkcs8"!==s||(g[0]="jwk"),b&&"wrapKey"===e)return h.exportKey(s,p).then(function(e){return"jwk"===s&&(e=n(unescape(encodeURIComponent(JSON.stringify(u(e)))))),h.encrypt(g[3],f,e)});var A;try{A=o.apply(h,g)}catch(e){return Promise.reject(e)}return b&&(A=new Promise(function(e,r){A.onabort=A.onerror=function(e){r(e)},A.oncomplete=function(r){e(r.target.result)}})),"exportKey"===e&&"jwk"===s&&(A=A.then(function(e){return(w||b&&"SHA-1"===(p.algorithm.hash||{}).name)&&"HMAC"===p.algorithm.name?{kty:"oct",alg:i(p.algorithm),key_ops:p.usages.slice(),ext:!0,k:r(a(e))}:((e=u(e)).alg||(e.alg=i(p.algorithm)),e.key_ops||(e.key_ops="public"===p.type?p.usages.filter(l):"private"===p.type?p.usages.filter(y):p.usages.slice()),e)})),!w||"exportKey"!==e||"spki"!==s&&"pkcs8"!==s||(A=A.then(function(e){return e=function(e){var r,a=[["",null]],o=!1;switch(e.kty){case"RSA":for(var i=["n","e","d","p","q","dp","dq","qi"],u=[],s=0;s<i.length&&i[s]in e;s++){var p=u[s]=n(t(e[i[s]]));128&p[0]&&(u[s]=new Uint8Array(p.length+1),u[s].set(p,1))}u.length>2&&(o=!0,u.unshift(new Uint8Array([0]))),a[0][0]="1.2.840.113549.1.1.1",r=u;break;default:throw new TypeError("Unsupported key type")}return a.push(new Uint8Array(c(r)).buffer),o?a.unshift(new Uint8Array([0])):a[1]={tag:3,value:a[1]},new Uint8Array(c(a)).buffer}(u(e))})),A}}),["encrypt","decrypt","sign","verify"].forEach(function(e){var r=h[e];h[e]=function(t,n,a,i){if(b&&(!a.byteLength||i&&!i.byteLength))throw new Error("Empy input is not allowed");var u=[].slice.call(arguments),s=o(t);if(b&&"decrypt"===e&&"AES-GCM"===s.name){var c=t.tagLength>>3;u[2]=(a.buffer||a).slice(0,a.byteLength-c),t.tag=(a.buffer||a).slice(a.byteLength-c)}u[1]=n._key;var p;try{p=r.apply(h,u)}catch(e){return Promise.reject(e)}return b&&(p=new Promise(function(r,t){p.onabort=p.onerror=function(e){t(e)},p.oncomplete=function(t){t=t.target.result;if("encrypt"===e&&t instanceof AesGcmEncryptResult){var n=t.ciphertext,a=t.tag;(t=new Uint8Array(n.byteLength+a.byteLength)).set(new Uint8Array(n),0),t.set(new Uint8Array(a),n.byteLength),t=t.buffer}r(t)}})),p}}),b){var v=h.digest;h.digest=function(e,r){if(!r.byteLength)throw new Error("Empy input is not allowed");var t;try{t=v.call(h,e,r)}catch(e){return Promise.reject(e)}return t=new Promise(function(e,r){t.onabort=t.onerror=function(e){r(e)},t.oncomplete=function(r){e(r.target.result)}})},e.crypto=Object.create(f,{getRandomValues:{value:function(e){return f.getRandomValues(e)}},subtle:{value:h}}),e.CryptoKey=p}w&&(f.subtle=h,e.Crypto=g,e.SubtleCrypto=A,e.CryptoKey=p)}}}});
//# sourceMappingURL=webcrypto-shim.min.js.map
